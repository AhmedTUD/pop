#!/bin/bash

# ุณูุฑูุจุช ูุดุฑ ุงููุดุฑูุน ุนูู VPS Linux
# ุชุฃูุฏ ูู ุชุดุบูู ูุฐุง ุงูุณูุฑูุจุช ุจุตูุงุญูุงุช sudo

echo "๐ ุจุฏุก ูุดุฑ ูุดุฑูุน POP Materials..."

# ุงูุชุญูู ูู ูุฌูุฏ Docker
if ! command -v docker &> /dev/null; then
    echo "โ Docker ุบูุฑ ูุซุจุช. ูุฑุฌู ุชุซุจูุช Docker ุฃููุงู"
    exit 1
fi

# ุงูุชุญูู ูู ูุฌูุฏ Docker Compose
if ! command -v docker-compose &> /dev/null; then
    echo "โ Docker Compose ุบูุฑ ูุซุจุช. ูุฑุฌู ุชุซุจูุช Docker Compose ุฃููุงู"
    exit 1
fi

# ุฅูุดุงุก ููู .env ุฅุฐุง ูู ููู ููุฌูุฏุงู
if [ ! -f .env ]; then
    echo "๐ ุฅูุดุงุก ููู .env..."
    cp .env.docker .env
    echo "โ๏ธ ูุฑุฌู ุชุนุฏูู ููู .env ุจุงูููู ุงูุตุญูุญุฉ ูุจู ุงููุชุงุจุนุฉ"
    read -p "ุงุถุบุท Enter ูููุชุงุจุนุฉ ุจุนุฏ ุชุนุฏูู ููู .env..."
fi

# ุฅููุงู ุงูุญุงููุงุช ุงูุณุงุจูุฉ ุฅู ูุฌุฏุช
echo "๐ ุฅููุงู ุงูุญุงููุงุช ุงูุณุงุจูุฉ..."
docker-compose down

# ุจูุงุก ุงูุตูุฑุฉ ุงูุฌุฏูุฏุฉ
echo "๐จ ุจูุงุก ุตูุฑุฉ Docker..."
docker-compose build --no-cache

# ุชุดุบูู ุงูุญุงููุงุช
echo "โถ๏ธ ุชุดุบูู ุงูุชุทุจูู..."
docker-compose up -d

# ุงูุชุญูู ูู ุญุงูุฉ ุงูุญุงููุงุช
echo "โ ุงูุชุญูู ูู ุญุงูุฉ ุงูุชุทุจูู..."
sleep 5
docker-compose ps

# ุนุฑุถ ุงูููุฌุฒ
echo "๐ ุนุฑุถ ุขุฎุฑ ุงูููุฌุฒ..."
docker-compose logs --tail=20

echo ""
echo "๐ ุชู ูุดุฑ ุงูุชุทุจูู ุจูุฌุงุญ!"
echo "๐ ุงูุชุทุจูู ูุนูู ุนูู ุงููููุฐ 5001"
echo "๐ ููููู ุงููุตูู ููุชุทุจูู ุนุจุฑ: http://your-server-ip:5001"
echo ""
echo "๐ ุฃูุงูุฑ ูููุฏุฉ:"
echo "   ุนุฑุถ ุงูููุฌุฒ: docker-compose logs -f"
echo "   ุฅููุงู ุงูุชุทุจูู: docker-compose down"
echo "   ุฅุนุงุฏุฉ ุชุดุบูู: docker-compose restart"
echo "   ุชุญุฏูุซ ุงูุชุทุจูู: ./deploy.sh"