#!/bin/bash

# ุณูุฑูุจุช ุฅุตูุงุญ ุณุฑูุน ููุดููุฉ ุงููุดุฑ

echo "๐ง ุฅุตูุงุญ ูุดููุฉ ุงููุดุฑ..."

# ุฅููุงู ุงูุญุงููุงุช ุงููุนุทูุฉ
echo "๐ ุฅููุงู ุงูุญุงููุงุช..."
docker-compose -f docker-compose.prod.yml down --remove-orphans

# ุญุฐู ุงูุตูุฑ ุงููุนุทูุฉ
echo "๐งน ุชูุธูู Docker..."
docker system prune -f

# ุชุดุบูู ุงูุชุทุจูู ุจุฏูู Nginx ุงูุฏุงุฎูู
echo "๐ ุชุดุบูู ุงูุชุทุจูู..."
docker-compose -f docker-compose.prod.yml up -d

# ุงูุชุธุงุฑ ุจุฏุก ุงูุชุทุจูู
echo "โณ ุงูุชุธุงุฑ ุจุฏุก ุงูุชุทุจูู..."
sleep 15

# ูุญุต ุญุงูุฉ ุงูุชุทุจูู
echo "๐ฅ ูุญุต ุญุงูุฉ ุงูุชุทุจูู..."
if curl -f http://localhost:5001/ &> /dev/null; then
    echo "โ ุงูุชุทุจูู ูุนูู ุจูุฌุงุญ ุนูู ุงููููุฐ 5001"
else
    echo "โ ูุดููุฉ ูู ุงูุชุทุจูู"
    docker-compose -f docker-compose.prod.yml logs --tail=20
    exit 1
fi

# ุนุฑุถ ุญุงูุฉ ุงูุญุงููุงุช
echo "๐ ุญุงูุฉ ุงูุญุงููุงุช:"
docker-compose -f docker-compose.prod.yml ps

echo ""
echo "๐ ุชู ุฅุตูุงุญ ุงููุดููุฉ ุจูุฌุงุญ!"
echo "๐ ุงูุชุทุจูู ูุนูู ุนูู: http://localhost:5001"
echo ""
echo "๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ:"
echo "1. ุฅุนุฏุงุฏ Nginx ุฎุงุฑุฌูุงู (ุฅุฐุง ูู ููู ูุนุฏุงู)"
echo "2. ุงูุญุตูู ุนูู ุดูุงุฏุฉ SSL"
echo "3. ุฅุนุฏุงุฏ ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ"